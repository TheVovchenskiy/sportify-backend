# Parser bot

Этот бот работает неким "прокси" между телеграм чатом и api.

## Начало работы

### Установка python

Для начала работы необходимо установить python (рекомендую использовать [venv](https://docs.python.org/3/library/venv.html)). Версия питона 3.12 (протестировано только на этой версии, если ниже, то могут быть возникнуть какие-то проблемы).

### Установка зависимостей

Далее необходимо установить зависимости. Для этого используйте команду:

```bash
$ BOT_TOKEN=<bot-token> pip install -r requirements.txt
```

### Конфиги

Далее необходимо создать конфигурационный файл. Для этого скопируйте файл [`config/config.example.yaml`](../config/config.example.yaml) в `config/config.example.yaml` (или можете назвать по-своему). Более подробно конфигурация для бота расписана в классе конфига [`bot/config.py`](../bot/config.py). Пока что там полей мало, но в дальнейшем вероятно их может стать больше, более того, если конфиги будут делиться с самой api, то возможно модифицировать конфигурацию бота и всего приложения в целом.

## Запуск

Теперь, когда все необходимое установлено, можно запускать бота. Для этого можно использовать команду **из корня репозитория**:

```bash
$ python bot/main.py ../config/config.yaml
```

Более подробную информацию о данной команде можно получить с помощью флага `--help`:

```bash
$ python bot/main.py --help
```

Теперь бот слушает все чаты, в которые его добавили и отправляет на указанные в конфиге url данные в формате `json`. Вот примерный формат данных, который стоит ожидать на стороне бекэнда:

```json
{
  "channel_chat_created": false,
  "delete_chat_photo": false,
  "group_chat_created": false,
  "supergroup_chat_created": false,
  "text": "message text",
  "chat": {
    "id": -4508299977,
    "title": "Test Sportify Chat",
    "type": "group",
    "all_members_are_administrators": true
  },
  "date": 1728694214,
  "message_id": 31,
  "from": {
    "first_name": "<sender_first_name>",
    "id": 794758483,
    "is_bot": false,
    "language_code": "en",
    "last_name": "<sender_last_name>",
    "username": "<sender_username>"
  }
}
```

Отправляются сообщения только из публичных чатов и от реальных пользователей, остальные сообщения игнорируются.
