package main

import (
	"fmt"
	"regexp"
	"strings"
)

var (
	errInvalidMinMatches = fmt.Errorf("Invalid minMatches value")
	errCompilingError    = fmt.Errorf("Error compiling regular expression")
	errMatchingError     = fmt.Errorf("Error matching regular expression")

	sportEventRegExps = []string{
		`(?i)\b(?:–º–∞–Ω–µ–∂|—Å—Ç–∞–¥–∏–æ–Ω|–º–µ—Ç—Ä–æ|–ø–∞—Ä–∫|–ø–æ–ª–µ)\b.*?(?:¬´[^¬ª]+¬ª|".+?"|[–ê-–Ø–Å–∞-—è—ë]+)`,                                                       // place
		`\b(?:\d{1,2}\s*(?:—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è|–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è)|\d{1,2}.\d{1,2}.\d{2,4})\b`, // date
		`\b\d{1,2}:\d{2}(?:-\d{1,2}:\d{2})?\b`,                                           // time
		`\b(?:\d+\s*–∫–æ–º–∞–Ω–¥[—ã–∞]?\s*\d+(√ó|\*|–Ω–∞|x|—Ö)\d+|\d+(√ó|\*|–Ω–∞|x|—Ö)\d+)\b`,            // game format
		`\b\d+(?:.\d+)?\s*(?:—á–∞—Å[–∞–æ–≤]|–º–∏–Ω—É—Ç[—ã–∞])\b`,                                      // duration
		`\b(–≤–∑–Ω–æ—Å|—Ü–µ–Ω–∞)\s*\d+\s*(?:—Ä.?|—Ä—É–±–ª(?:–µ–π|—è)?)\b|\b\d+\s*(?:—Ä.?|—Ä—É–±–ª(?:–µ–π|—è)?)\b`, // price FIXME: this does not work as planned
		`\b(?:—Ç—Ä–µ–±—É–µ—Ç—Å—è|–Ω—É–∂–Ω–æ|–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç)\s*\d+\s*(?:—á–µ–ª–æ–≤–µ–∫|–∏–≥—Ä–æ–∫[–æ–≤]|–º–µ—Å—Ç[–∞–æ])\b`,      // level
		`\b(?:–≤–∏–¥–µ–æ(?:—Å—ä—ë–º–∫–∞)?|–≤–æ–¥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤|–¥—É—à–µ–≤—ã–µ|—Ä–∞–∑–¥–µ–≤–∞–ª–∫–∏)\b`,                   // facilities
		`\b(?:–∏–≥—Ä–∞–µ–º|–ø–æ–∏–≥—Ä–∞—Ç—å|–º–∞—Ç—á|—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞)\b`,                                        // type
		`\bhttps?:\/\/[^\s]+`, // link

		"\b(—Ç—É—Ä–Ω–∏—Ä|—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ|–º–∞—Ç—á|–≤—Å—Ç—Ä–µ—á–∞)\b",
		"\b(–∏–≥—Ä–∞|–ø–æ–µ–¥–∏–Ω–æ–∫|–º–∞—Ç—á)\b.*\b(–ø–æ|–ø—Ä–æ—Ç–∏–≤|—Å)\b",
		"\b(–∏–≥—Ä–∞|–ø–æ–µ–¥–∏–Ω–æ–∫|–º–∞—Ç—á)\b.*\b(–≤–∏–¥ —Å–ø–æ—Ä—Ç–∞|–≤–∏–¥–æ–º —Å–ø–æ—Ä—Ç–∞|—Ç–∏–ø —Å–ø–æ—Ä—Ç–∞|—Ç–∏–ø–æ–º —Å–ø–æ—Ä—Ç–∞)\b",
		"\b(–ø—Ä–æ—Ö–æ–¥–∏—Ç|—Å–æ—Å—Ç–æ–∏—Ç—Å—è|–Ω–∞—á–Ω–µ—Ç—Å—è|–∑–∞–∫–æ–Ω—á–∏—Ç—Å—è)\b.*\b(–≤|–Ω–∞)\b.*\b(–º–µ—Å—Ç–æ|–ª–æ–∫–∞—Ü–∏—è|–∞–¥—Ä–µ—Å)\b",
		"\b(–¥–∞—Ç–∞|–≤—Ä–µ–º—è|–∫–æ–≥–¥–∞)\b.*\b(–ø—Ä–æ—Ö–æ–¥–∏—Ç|—Å–æ—Å—Ç–æ–∏—Ç—Å—è|–Ω–∞—á–Ω–µ—Ç—Å—è|–∑–∞–∫–æ–Ω—á–∏—Ç—Å—è)\b",
		"\b(—Ç—Ä–µ–±—É–µ—Ç—Å—è|–Ω—É–∂–µ–Ω|–∂–µ–ª–∞—Ç–µ–ª–µ–Ω)\b.*\b(—É—Ä–æ–≤–µ–Ω—å|—É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞|—É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–æ–≤)\b",
		"\b(—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å|–≤–∑–Ω–æ—Å|–ø–ª–∞—Ç–∞)\b",
		"\b(–ø–ª–∞—Ç–Ω–∞—è|–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è|—Å—Ç–æ–∏—Ç)\b",
		"\b(–∫–æ–º–∞–Ω–¥–∞|–∫–æ–º–∞–Ω–¥–∏—Ä|–∏–≥—Ä–æ–∫)\b.*\b(—Ç—Ä–µ–±—É–µ—Ç—Å—è|–Ω—É–∂–µ–Ω|–∂–µ–ª–∞—Ç–µ–ª–µ–Ω)\b",
		"\b(–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è|—É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å|—É—á–∞—Å—Ç–≤—É–π—Ç–µ)\b",
		"\b(—Ç—É—Ä|–º–∞—Ç—á|–∏–≥—Ä–∞)\b.*\b(–ø–ª–∞—Ç–Ω–æ|–±–µ—Å–ø–ª–∞—Ç–Ω–æ)\b",
		"\b(—Å–æ–±—ã—Ç–∏–µ|–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ)\b.*\b(—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ|–≤–∏–¥ —Å–ø–æ—Ä—Ç–∞|—Ç–∏–ø —Å–ø–æ—Ä—Ç–∞)\b",
	}
)

// detect checks if a string satisfies a specified number of regular expressions.
func detect(text string, regexps []string, minMatches int) (bool, error) {
	lowerText := strings.ToLower(text)
	if minMatches < 0 {
		return false, fmt.Errorf("%w: must be >= 0", errInvalidMinMatches)
	}
	if minMatches == 0 {
		return true, nil
	}

	matched := 0

	for _, regex := range regexps {
		re, err := regexp.Compile(regex)
		if err != nil {
			return false, fmt.Errorf("%w %q: %w", errCompilingError, regex, err)
		}
		if re.MatchString(lowerText) {
			matched++
		}
		if matched >= minMatches {
			return true, nil
		}
	}

	if matched < minMatches {
		return false, fmt.Errorf(
			"%w: the string does not satisfy the specified minimum number of regular expressions (%d of %d)",
			errMatchingError,
			matched,
			minMatches,
		)
	}

	return true, nil
}

// PASS

// üìç–ú–∞–Ω–µ–∂ "–°–ø–æ—Ä—Ç–í—Å–µ–≥–¥–∞"
// –í—Ä–µ–º—è 21:30-23:00
// –ö–æ–≥–¥–∞: 14.10.2024
// üìç–º. –ö–æ–Ω—å–∫–æ–≤–æ
// –º. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –î—Ä—É–∂–±—ã –ù–∞—Ä–æ–¥–æ–≤
// üîπ3 –∫–æ–º–∞–Ω–¥—ã 6√ó6
// üîπ–í–∏–¥–µ–æ, –≤–æ–¥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
// üîπ–í–∑–Ω–æ—Å 1100—Ä.`

// 	üîª–ï—Å—Ç—å 4 –º–µ—Å—Ç–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—èüîª
// üìç–°—Ç–∞–¥–∏–æ–Ω "–Ø—Å–µ–Ω–µ–≤–æ"
// üîπ–ú. –Ø—Å–µ–Ω–µ–≤–æ 21:30
// üîπ2 –∫–æ–º–∞–Ω–¥—ã 8√ó8
// üîπ1,5 —á–∞—Å–∞ –∏–≥—Ä—ã –Ω–æ–Ω-—Å—Ç–æ–ø
// üîπ–í–∏–¥–µ–æ—Å—ä—ë–º–∫–∞ –≤—Å–µ–π –∏–≥—Ä—ã + –Ω–∞—Ä–µ–∑–∫–∞ –ª—É—á—à–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –≤–æ–¥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
// üîπ–í–∑–Ω–æ—Å 850
// ‚ùó –ï—Å—Ç—å –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã%
// –ö—Ç–æ –≥–æ—Ç–æ–≤ —Å—Ç–∞–≤–∏–º ‚ûï
// –ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Äüîª
// https://footballvmoskve.ru/`

// –ü–∞—Ä–∫ ¬´–°–æ–∫–æ–ª—å–Ω–∏–∫–∏¬ª
// –ú–∏—Ç—å–∫–æ–≤—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, –¥. 1
// –û—Ç–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –≤ –ø–∞—Ä–∫–µ ¬´–°–æ–∫–æ–ª—å–Ω–∏–∫–∏¬ª
// –†–∞–∑–º–µ—Ä –ø–æ–ª—è: 50 x 80
// –î—É—à–µ–≤—ã–µ, —Ä–∞–∑–¥–µ–≤–∞–ª–∫–∏
// –ò–≥—Ä–∞–µ–º 7—Ö7 –∏ 10—Ö10
// 16 –û–∫—Ç—è–±—Ä—è 21:00-22:30
// 750‚ÇΩ
// 1/2 –±–æ–ª—å—à–æ–≥–æ –ø–æ–ª—è, 3 –∫–æ–º–∞–Ω–¥—ã (7—Ö7)`

////////////////////////

// FAIL

// –¢—Ä–µ–±—É–µ—Ç—Å—è 5 —á–µ–ª–æ–≤–µ–∫ –¥–ª—è –∏–≥—Ä—ã –≤ —Ñ—É—Ç–±–æ–ª. –ò–≥—Ä–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ –ú–æ—Å–∫–≤–µ. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã. –¶–µ–Ω–∞ - 1000 —Ä—É–±–ª–µ–π. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å!

// –ú–µ—Ç—Ä–æ –ß–µ—Ä—Ç–∞–Ω–æ–≤—Å–∫–∞—è, –ß–µ—Ä—Ç–∞–Ω–æ–≤—Å–∫–∞—è —É–ª., 7, –∫–æ—Ä–ø. 3
// –§–æ—Ä–º–∞—Ç 9*9
// 15 –æ–∫—Ç—è–±—Ä—è
// 2 –∫–æ–º–∞–Ω–¥—ã, –≤—Ä–µ–º—è –∏–≥—Ä—ã 90 –º–∏–Ω—É—Ç
// –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞ –º–∞—Ç—á–µ
// –ú—è—á–∏, –º–∞–Ω–∏—à–∫–∏, –∑–∞–º–æ—Ä–æ–∑–∫–∞ –∏ –≤–æ–¥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
// –í–∏–¥–µ–æ —Å—ä–µ–º–∫–∞ –∫—Ä–∞—Å–∏–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤
// –†–∞–∑–¥–µ–≤–∞–ª–∫–∏ –∏ –¥—É—à–µ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã
// –£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
// –¶–µ–Ω–∞ 1200 —Ä—É–±–ª–µ–π

// –î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ï—Å—Ç—å –∂–µ–ª–∞—é—â–∏–µ 16.10 –ø–æ–∏–≥—Ä–∞—Ç—å –Ω–∞ –º–∞–Ω–µ–∂–µ –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç 32/43,
// —É –Ω–∞—Å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω –º–∞–Ω–µ–∂ –Ω–∞ –ø–æ–ª—Ç–æ—Ä–∞ —á–∞—Å–∞ —Å 19:00 –¥–æ 20:30, –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞—Ä–æ–¥—É 3-5 —á–µ–ª–æ–≤–µ–∫ —Ü–µ–Ω–∞ 750 —Ä—É–±–ª–µ–π.
